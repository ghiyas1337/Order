<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Dashboard Rtm</title>
  <style>
    :root {
      --primary-color: #3a86ff;
      --secondary-color: #8338ec;
      --accent-color: #ffbe0b;
      --bg-color: #1e1e2f;
      --text-color: #eee;
      --border-radius: 12px;
      --shadow: 0 8px 24px rgba(0,0,0,0.6);
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--bg-color);
      color: var(--text-color);
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 0;
      overflow: hidden;
    }
    h1,h2,h3,h4 {
      margin: 0 0 1rem 0;
      user-select: none;
    }
    button {
      cursor: pointer;
      border: none;
      border-radius: var(--border-radius);
      background: var(--primary-color);
      color: white;
      font-weight: 600;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      transition: background 0.3s ease;
      user-select: none;
    }
    button:hover:not(:disabled) {
      background: var(--secondary-color);
    }
    button:disabled {
      background: #555;
      cursor: not-allowed;
    }
    input, textarea {
      font-family: inherit;
      font-size: 1rem;
      padding: 0.5rem;
      border-radius: var(--border-radius);
      border: 1px solid #444;
      outline: none;
      width: 100%;
      box-sizing: border-box;
      background: #2e2e40;
      color: var(--text-color);
      transition: border-color 0.3s ease;
      resize: vertical;
    }
    input:focus, textarea:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 6px var(--primary-color);
    }
    select {
      font-family: inherit;
      font-size: 1rem;
      padding: 0.4rem 0.6rem;
      border-radius: var(--border-radius);
      border: 1px solid #444;
      background: #2e2e40;
      color: var(--text-color);
      width: 100%;
      box-sizing: border-box;
      outline: none;
      appearance: none;
    }
    select:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 6px var(--primary-color);
    }
    #login-container {
      max-width: 360px;
      margin: auto;
      margin-top: 6rem;
      background: #2e2e40;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      padding: 2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #login-container h2 {
      color: var(--primary-color);
      margin-bottom: 1rem;
    }
    label {
      align-self: flex-start;
      margin-top: 1rem;
      font-weight: 600;
    }
    form {
      width: 100%;
    }
    #login-error {
      margin-top: 1rem;
      color: #ff4d4d;
      font-weight: 700;
      text-align: center;
      min-height: 1.2rem;
      user-select: none;
    }

    #dashboard {
      display: none;
      height: 100vh;
      width: 100vw;
      max-width: 1200px;
      margin: auto;
      display: flex;
      background: var(--bg-color);
      color: var(--text-color);
      border-radius: var(--border-radius);
      overflow: hidden;
      box-shadow: var(--shadow);
    }
    #sidebar {
      width: 260px;
      background: #2b2b44;
      display: flex;
      flex-direction: column;
      padding: 1rem 1.5rem;
      border-right: 1px solid #444;
    }
    #sidebar h2 {
      margin-bottom: 1rem;
    }
    #sidebar button {
      background: transparent;
      margin-bottom: 1rem;
      color: var(--text-color);
      text-align: left;
      padding-left: 0;
      font-weight: 600;
    }
    #sidebar button:hover, #sidebar button.active {
      background: var(--primary-color);
      color: #fff;
    }
    #sidebar #btn-logout {
      margin-top: auto;
      background: #d9534f;
      font-weight: 700;
    }

    #main-content {
      flex-grow: 1;
      padding: 1rem 2rem;
      overflow-y: auto;
      background: #23233a;
      border-radius: 0 var(--border-radius) var(--border-radius) 0;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    /* Chats list */
    #users-list {
      max-height: 190px;
      overflow-y: auto;
      border-bottom: 1px solid #444;
      margin-bottom: 1rem;
    }
    .user-item {
      padding: 0.5rem 0.25rem;
      cursor: pointer;
      border-radius: 6px;
      user-select: text;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: 600;
      color: #ccc;
      transition: background 0.2s ease;
    }
    .user-item:hover,
    .user-item.active {
      background: var(--primary-color);
      color: white;
    }
    .user-item span {
      flex-grow: 1;
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
      padding-right: 0.4rem;
    }
    .user-item small {
      font-weight: 400;
      font-size: 0.85rem;
      color: #aaa;
      flex-shrink: 0;
    }

    /* Chat box */
    #chat-section {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      border: 1px solid #444;
      border-radius: var(--border-radius);
      background: #1a1a2e;
      overflow: hidden;
      min-height: 0;
    }
    #chat-messages {
      flex-grow: 1;
      overflow-y: auto;
      padding: 1rem;
      font-size: 0.9rem;
      line-height: 1.3;
      min-height: 100px;
    }
    .message {
      max-width: 75%;
      padding: 0.5rem 1rem;
      border-radius: var(--border-radius);
      margin-bottom: 0.5rem;
      word-wrap: break-word;
      position: relative;
      box-shadow: 0 1px 3px rgba(0,0,0,0.3);
    }
    .message.user {
      background: var(--accent-color);
      color: #222;
      margin-left: auto;
      border-bottom-right-radius: 4px;
    }
    .message.admin {
      background: #444874;
      color: var(--text-color);
      margin-right: auto;
      border-bottom-left-radius: 4px;
    }
    .message img {
      max-width: 200px;
      border-radius: var(--border-radius);
      margin-top: 0.25rem;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }
    #chat-form {
      display: flex;
      border-top: 1px solid #555;
      padding: 0.5rem 1rem;
      background: #2b2b44;
      border-bottom-left-radius: var(--border-radius);
      border-bottom-right-radius: var(--border-radius);
    }
    #chat-input {
      flex-grow: 1;
      padding: 0.5rem 1rem;
      border-radius: var(--border-radius);
      border: none;
      resize: vertical;
      font-size: 1rem;
      font-family: inherit;
      outline: none;
      background: #353550;
      color: var(--text-color);
      min-height: 40px;
    }
    #chat-send-btn {
      margin-left: 0.75rem;
      background: var(--primary-color);
      border-radius: var(--border-radius);
      border: none;
      padding: 0 1.2rem;
      font-weight: 700;
      font-size: 1rem;
      color: white;
      user-select: none;
      transition: background 0.3s ease;
      height: 40px;
    }
    #chat-send-btn:disabled {
      background: #666;
      cursor: not-allowed;
    }
    #chat-send-btn:hover:not(:disabled) {
      background: var(--secondary-color);
    }

    #screenshots-section {
      display: none;
      margin-top: 1rem;
      flex-grow: 1;
      overflow-y: auto;
      max-height: calc(100vh - 100px);
    }
    #screenshots-list {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      max-height: 100%;
      overflow-y: auto;
    }
    .screenshot-item {
      flex: 1 0 140px;
      background: #3a3a5c;
      border-radius: var(--border-radius);
      box-shadow: inset 0 0 8px rgba(255,255,255,0.1);
      cursor: pointer;
      display: flex;
      flex-direction: column;
      padding: 0.5rem;
      overflow: hidden;
      transition: transform 0.15s ease;
      user-select: none;
    }
    .screenshot-item:hover {
      transform: scale(1.04);
      box-shadow: 0 5px 20px rgba(0,0,0,0.5);
    }
    .screenshot-item img {
      width: 100%;
      height: 100px;
      object-fit: contain;
      border-radius: 8px;
      margin-bottom: 0.3rem;
    }
    .screenshot-name {
      font-size: 0.85rem;
      text-align: center;
      color: var(--accent-color);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      user-select: text;
    }

    /* Modal */
    #modal-bg {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }
    #modal-bg.active {
      display: flex;
    }
    #modal-content {
      background: white;
      border-radius: var(--border-radius);
      max-width: 95vw;
      max-height: 95vh;
      padding: 1rem;
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
      position: relative;
      user-select: none;
    }
    #modal-content img {
      max-width: 100%;
      max-height: 85vh;
      display: block;
      margin: 0 auto;
      border-radius: var(--border-radius);
    }
    #modal-close {
      position: absolute;
      top: 10px; right: 15px;
      font-size: 1.8rem;
      font-weight: 700;
      color: #333;
      cursor: pointer;
      background: transparent;
      border: none;
      user-select: none;
      line-height: 1;
    }

    /* Responsive */
    @media (max-width: 900px) {
      #dashboard {
        flex-direction: column;
      }
      #sidebar {
        width: 100%;
        height: auto;
        border-right: none;
        border-bottom: 1px solid #444;
        flex-direction: row;
        padding: 0.5rem;
        overflow-x: auto;
      }
      #sidebar button {
        margin: 0 0.5rem 0 0;
        flex: 1 0 auto;
        text-align: center;
      }
      #main-content {
        height: auto;
        padding: 1rem 1rem 2rem 1rem;
      }
      #users-list {
        max-height: 150px;
      }
    }
  </style>
</head>
<body>
  <div id="login-container" role="main" aria-label="Admin login form">
    <h2>Admin Login</h2>
    <form id="login-form" autocomplete="off" aria-describedby="login-error" aria-label="Admin login form">
      <label for="username">Username</label>
      <input type="text" id="username" name="username" required autocomplete="username" />
      <label for="password">Password</label>
      <input type="password" id="password" name="password" required autocomplete="current-password" />
      <button type="submit">Login</button>
      <div id="login-error" role="alert" aria-live="assertive" aria-atomic="true"></div>
    </form>
  </div>

  <div id="dashboard" aria-label="Admin dashboard" role="region">
    <nav id="sidebar" aria-label="Dashboard navigation">
      <h2>Dashboard</h2>
      <button id="btn-chats" class="active" aria-pressed="true">Chats</button>
      <button id="btn-screenshots" aria-pressed="false">Payment Screenshots</button>
      <button id="btn-logout">Logout</button>
    </nav>
    <main id="main-content" tabindex="0">
      <!-- Chats Section -->
      <section id="chats-section">
        <h3>Users</h3>
        <div id="users-list" tabindex="0" aria-label="List of chatting users"></div>

        <div id="chat-section" aria-label="Chat conversation" style="display:none;">
          <h4 id="chat-user-title"></h4>
          <div id="chat-messages" tabindex="0" aria-live="polite" aria-atomic="false" style="flex-grow:1; overflow-y:auto;"></div>
          <form id="chat-form" autocomplete="off" aria-label="Send chat message form" style="display:flex; margin-top: 0.5rem;">
            <textarea id="chat-input" rows="2" placeholder="Type your message here..." aria-required="true" required></textarea>
            <button type="submit" id="chat-send-btn" disabled>Send</button>
          </form>
        </div>
      </section>

      <!-- Payment Screenshots Section -->
      <section id="screenshots-section" style="display:none;">
        <h3>Uploaded Payment Screenshots</h3>
        <div id="screenshots-list" tabindex="0" aria-label="List of uploaded payment screenshots"></div>
      </section>
    </main>
  </div>

  <!-- Modal for Screenshot Preview -->
  <div id="modal-bg" role="dialog" aria-modal="true" aria-hidden="true">
    <section id="modal-content" tabindex="-1">
      <button id="modal-close" aria-label="Close modal">&times;</button>
      <img id="modal-image" alt="Screenshot preview" />
    </section>
  </div>

  <script>
    (() => {
      const ADMIN_USER = 'diasz';
      const ADMIN_PASS = 'kodes123';

      // Elements
      const loginContainer = document.getElementById('login-container');
      const loginForm = document.getElementById('login-form');
      const loginError = document.getElementById('login-error');
      const dashboard = document.getElementById('dashboard');
      const btnChats = document.getElementById('btn-chats');
      const btnScreenshots = document.getElementById('btn-screenshots');
      const btnLogout = document.getElementById('btn-logout');
      const chatsSection = document.getElementById('chats-section');
      const screenshotsSection = document.getElementById('screenshots-section');
      const usersList = document.getElementById('users-list');
      const chatSection = document.getElementById('chat-section');
      const chatUserTitle = document.getElementById('chat-user-title');
      const chatMessages = document.getElementById('chat-messages');
      const chatForm = document.getElementById('chat-form');
      const chatInput = document.getElementById('chat-input');
      const chatSendBtn = document.getElementById('chat-send-btn');

      const screenshotsList = document.getElementById('screenshots-list');

      const modalBg = document.getElementById('modal-bg');
      const modalClose = document.getElementById('modal-close');
      const modalImage = document.getElementById('modal-image');

      const CHAT_STORAGE_KEY = 'payment_chat_messages';
      const SCREENSHOT_STORAGE_KEY = 'payment_uploaded_screenshots';

      let selectedUserId = null;

      loginForm.addEventListener('submit', e => {
        e.preventDefault();
        loginError.textContent = '';
        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value;
        if(username === ADMIN_USER && password === ADMIN_PASS) {
          loginContainer.style.display = 'none';
          dashboard.style.display = 'flex';
          loadUsersList();
          showChatsSection();
        } else {
          loginError.textContent = 'Invalid username or password.';
        }
      });

      btnLogout.addEventListener('click', ()=>{
        dashboard.style.display = 'none';
        loginContainer.style.display = 'flex';
        loginForm.reset();
        loginError.textContent = '';
        clearChat();
        clearUsersList();
        clearScreenshotsList();
      });

      btnChats.addEventListener('click', () => {
        showChatsSection();
      });
      btnScreenshots.addEventListener('click', () => {
        showScreenshotsSection();
      });

      function showChatsSection() {
        btnChats.classList.add('active');
        btnChats.setAttribute('aria-pressed', 'true');
        btnScreenshots.classList.remove('active');
        btnScreenshots.setAttribute('aria-pressed', 'false');
        screenshotsSection.style.display = 'none';
        chatsSection.style.display = 'block';
      }
      function showScreenshotsSection() {
        btnScreenshots.classList.add('active');
        btnScreenshots.setAttribute('aria-pressed', 'true');
        btnChats.classList.remove('active');
        btnChats.setAttribute('aria-pressed', 'false');
        chatsSection.style.display = 'none';
        screenshotsSection.style.display = 'block';
        loadScreenshotsList();
      }

      function loadAllChats() {
        return JSON.parse(localStorage.getItem(CHAT_STORAGE_KEY)) || [];
      }

      function loadScreenshots() {
        return JSON.parse(localStorage.getItem(SCREENSHOT_STORAGE_KEY)) || [];
      }

      function getUsers() {
        const chats = loadAllChats();
        const screenshots = loadScreenshots();
        const usersSet = new Set();
        chats.forEach(c => usersSet.add(c.userId));
        screenshots.forEach(s => usersSet.add(s.userId));
        return Array.from(usersSet);
      }

      function loadUsersList() {
        const users = getUsers();
        clearUsersList();
        if(users.length === 0) {
          const p = document.createElement('p');
          p.textContent = 'No users yet.';
          p.style.color = '#888';
          usersList.appendChild(p);
          chatSection.style.display = 'none';
          return;
        }
        users.forEach(userId => {
          const div = document.createElement('div');
          div.className = 'user-item';
          div.tabIndex = 0;
          div.setAttribute('role', 'button');
          div.setAttribute('aria-label', `Open chat with ${userId}`);
          div.innerHTML = `<span>${userId}</span><small>View Chat</small>`;
          div.addEventListener('click', () => { selectUser(userId, div); });
          div.addEventListener('keypress', e => {
            if(e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              selectUser(userId, div);
            }
          });
          usersList.appendChild(div);
        });
        if(users.length > 0) {
          const firstUserDiv = usersList.querySelector('.user-item');
          selectUser(users[0], firstUserDiv);
        }
      }

      function clearUsersList() {
        usersList.innerHTML = '';
      }

      function selectUser(userId, userDiv) {
        if(selectedUserId === userId) return;
        selectedUserId = userId;
        [...usersList.children].forEach(child => child.classList.remove('active'));
        if(userDiv) userDiv.classList.add('active');
        chatSection.style.display = 'flex';
        chatUserTitle.textContent = `Chat with: ${userId}`;
        renderChatMessages(userId);
        chatInput.value = '';
        chatSendBtn.disabled = true;
        chatInput.focus();
      }

      function renderChatMessages(userId) {
        const chats = loadAllChats().filter(c => c.userId === userId);
        chatMessages.innerHTML = '';
        if(chats.length === 0) {
          chatMessages.innerHTML = '<p style="text-align:center; color:#888;">No messages yet.</p>';
          chatMessages.scrollTop = chatMessages.scrollHeight;
          return;
        }
        chats.forEach(msg => {
          const div = document.createElement('div');
          div.className = 'message ' + (msg.sender === 'admin' ? 'admin' : 'user');
          if(msg.type === 'image') {
            const img = document.createElement('img');
            img.src = msg.text;
            img.alt = 'Uploaded Screenshot';
            img.tabIndex = 0;
            img.addEventListener('click', () => openModal(msg.text));
            img.addEventListener('keypress', e => {
              if(e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                openModal(msg.text);
              }
            });
            div.appendChild(img);
          } else {
            div.textContent = msg.text;
          }
          div.title = new Date(msg.timestamp).toLocaleString();
          chatMessages.appendChild(div);
        });
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }

      chatForm.addEventListener('submit', e => {
        e.preventDefault();
        if(!selectedUserId) return;
        const text = chatInput.value.trim();
        if(!text) return;
        const chats = loadAllChats();
        chats.push({
          id: 'msg-' + Date.now() + '-' + Math.random().toString(36).substr(2,6),
          userId: selectedUserId,
          sender: 'admin',
          text,
          timestamp: Date.now(),
          type: 'text'
        });
        localStorage.setItem(CHAT_STORAGE_KEY, JSON.stringify(chats));
        chatInput.value = '';
        chatSendBtn.disabled = true;
        renderChatMessages(selectedUserId);
      });

      chatInput.addEventListener('input', () => {
        chatSendBtn.disabled = chatInput.value.trim().length === 0;
      });

      // Load all payment screenshots uploaded by users (not from chat)
      function loadScreenshotsList() {
        const screenshots = loadScreenshots();
        screenshotsList.innerHTML = '';
        if(screenshots.length === 0) {
          const p = document.createElement('p');
          p.textContent = 'No payment screenshots uploaded yet.';
          p.style.color = '#888';
          screenshotsList.appendChild(p);
          return;
        }
        screenshots.forEach(ss => {
          const div = document.createElement('div');
          div.className = 'screenshot-item';
          div.tabIndex = 0;
          div.setAttribute('role', 'button');
          div.setAttribute('aria-label', `Payment screenshot from ${ss.userId}, file ${ss.name}, uploaded ${new Date(ss.timestamp).toLocaleString()}`);
          const img = document.createElement('img');
          img.src = ss.dataUrl;
          img.alt = `Payment screenshot uploaded by user`;
          div.appendChild(img);
          const label = document.createElement('div');
          label.className = 'screenshot-name';
          label.textContent = `${ss.userId} - ${ss.name}`;
          div.appendChild(label);
          div.addEventListener('click', () => openModal(ss.dataUrl));
          div.addEventListener('keypress', e => {
            if(e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              openModal(ss.dataUrl);
            }
          });
          screenshotsList.appendChild(div);
        });
      }

      function clearScreenshotsList() {
        screenshotsList.innerHTML = '';
      }

      // Modal open/close
      function openModal(src) {
        modalImage.src = src;
        modalBg.classList.add('active');
        modalBg.setAttribute('aria-hidden', 'false');
        modalImage.focus();
      }
      function closeModal() {
        modalBg.classList.remove('active');
        modalBg.setAttribute('aria-hidden', 'true');
        modalImage.src = '';
      }
      modalClose.addEventListener('click', closeModal);
      modalBg.addEventListener('click', e => {
        if(e.target === modalBg) closeModal();
      });
      document.addEventListener('keydown', e => {
        if(e.key === 'Escape' && modalBg.classList.contains('active')) closeModal();
      });

      function clearChat() {
        chatMessages.innerHTML = '';
        chatInput.value = '';
        chatSendBtn.disabled = true;
        chatUserTitle.textContent = '';
        chatSection.style.display = 'none';
        selectedUserId = null;
      }

      function clearUsersList() {
        usersList.innerHTML = '';
      }
      
      // Listen to storage events so admin can see new messages if any tab writes to localStorage
      window.addEventListener('storage', (e) => {
        if (e.key === CHAT_STORAGE_KEY) {
          if (selectedUserId) {
            renderChatMessages(selectedUserId);
          }
        }
      });
    })();
  </script>
</body>
</html>

